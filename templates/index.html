<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>California House Price Prediction | ML API</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
  <style>
    body{font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);min-height:100vh}
    .glass{background:rgba(255,255,255,.9);backdrop-filter:blur(10px);border-radius:20px;box-shadow:0 8px 32px rgba(31,38,135,.15)}
    .input-field{transition:all .25s}
    .input-field:focus{box-shadow:0 0 0 3px rgba(99,102,241,.35)}
    .fade-in{animation:fade .4s ease}
    @keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
    .kv{display:grid;grid-template-columns:160px 1fr;gap:.5rem .75rem}
    .btn{display:inline-flex;align-items:center;justify-content:center;border-radius:.75rem;padding:.75rem 1rem;font-weight:600}
  </style>
</head>
<body class="flex items-center justify-center p-4">
  <div class="glass w-full max-w-3xl p-8 md:p-10">
    <header class="flex flex-col items-center mb-8">
      <div class="flex items-center justify-center bg-indigo-100 rounded-full p-4 mb-4">
        <i class="fas fa-home text-indigo-600 text-3xl"></i>
      </div>
      <h1 class="text-3xl md:text-4xl font-bold text-gray-800 text-center mb-2">
        California House Price Prediction
      </h1>
      <p class="text-gray-600 text-center">
        Enter property details to estimate the median house value.
      </p>
    </header>

    <form id="form" class="space-y-4" novalidate>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1" for="MedInc">Median Income</label>
          <input class="input-field w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-indigo-500 focus:outline-none"
                 id="MedInc" name="MedInc" type="number" step="0.0001" placeholder="e.g. 8.3252" required>
          <p class="text-xs text-gray-500 mt-1">Median income in tens of thousands of dollars.</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1" for="HouseAge">House Age</label>
          <input class="input-field w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-indigo-500 focus:outline-none"
                 id="HouseAge" name="HouseAge" type="number" step="1" placeholder="e.g. 41" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1" for="AveRooms">Average Rooms</label>
          <input class="input-field w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-indigo-500 focus:outline-none"
                 id="AveRooms" name="AveRooms" type="number" step="0.0001" placeholder="e.g. 6.984" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1" for="AveBedrms">Average Bedrooms</label>
          <input class="input-field w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-indigo-500 focus:outline-none"
                 id="AveBedrms" name="AveBedrms" type="number" step="0.0001" placeholder="e.g. 1.0238" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1" for="Population">Population</label>
          <input class="input-field w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-indigo-500 focus:outline-none"
                 id="Population" name="Population" type="number" step="1" placeholder="e.g. 322" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1" for="AveOccup">Average Occupancy</label>
          <input class="input-field w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-indigo-500 focus:outline-none"
                 id="AveOccup" name="AveOccup" type="number" step="0.0001" placeholder="e.g. 2.555" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1" for="Latitude">Latitude</label>
          <input class="input-field w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-indigo-500 focus:outline-none"
                 id="Latitude" name="Latitude" type="number" step="0.0001" placeholder="e.g. 37.88" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1" for="Longitude">Longitude</label>
          <input class="input-field w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-indigo-500 focus:outline-none"
                 id="Longitude" name="Longitude" type="number" step="0.0001" placeholder="e.g. -122.23" required>
        </div>
      </div>

      <div class="flex gap-3 mt-6">
        <button id="predictBtn" type="submit"
          class="btn w-full bg-indigo-600 hover:bg-indigo-700 text-white transition transform hover:scale-[1.01]">
          <i class="fas fa-chart-line mr-2"></i> <span>Predict Price</span>
        </button>
        <button id="exampleBtn" type="button"
          class="btn bg-white border border-gray-300 text-gray-700 hover:bg-gray-50">
          <i class="fas fa-magic mr-2"></i> Example
        </button>
        <button id="resetBtn" type="button"
          class="btn bg-white border border-gray-300 text-gray-700 hover:bg-gray-50">
          <i class="fas fa-rotate-left mr-2"></i> Reset
        </button>
      </div>
    </form>

    <div id="alert" class="hidden mt-4 p-4 rounded bg-red-50 text-red-700"></div>

    <section id="result" class="hidden prediction-result mt-8 p-6 bg-white rounded-xl border border-indigo-100 fade-in">
      <h3 class="text-lg font-semibold text-indigo-800 mb-4 flex items-center">
        <i class="fas fa-receipt mr-2"></i> Prediction Summary
      </h3>

      <div class="grid md:grid-cols-2 gap-6">
        <div class="p-4 rounded-lg bg-indigo-50 border border-indigo-100">
          <div class="text-sm text-indigo-700 mb-2 font-medium">Inputs</div>
          <div id="inputs" class="kv text-sm"></div>
        </div>

        <div class="p-4 rounded-lg bg-emerald-50 border border-emerald-100">
          <div class="text-sm text-emerald-700 mb-2 font-medium">Estimated Price</div>
          <div class="text-3xl font-extrabold text-emerald-900" id="pred"></div>
          <p class="text-xs text-emerald-700 mt-2">
            Estimated median house value for the tract (USD).
          </p>
        </div>
      </div>
    </section>
  </div>

  <script>
    const form = document.getElementById('form');
    const predictBtn = document.getElementById('predictBtn');
    const exampleBtn = document.getElementById('exampleBtn');
    const resetBtn = document.getElementById('resetBtn');
    const alertBox = document.getElementById('alert');
    const resultBox = document.getElementById('result');
    const predBox = document.getElementById('pred');
    const inputsBox = document.getElementById('inputs');

    function money(v){return new Intl.NumberFormat('en-US',{style:'currency',currency:'USD'}).format(v)}
    function setLoading(state){
      predictBtn.disabled = state;
      predictBtn.querySelector('span').textContent = state ? 'Predicting...' : 'Predict Price';
    }
    function fillExample(){
      form.MedInc.value = 8.3252;
      form.HouseAge.value = 41;
      form.AveRooms.value = 6.984;
      form.AveBedrms.value = 1.0238;
      form.Population.value = 322;
      form.AveOccup.value = 2.555;
      form.Latitude.value = 37.88;
      form.Longitude.value = -122.23;
    }

    exampleBtn.addEventListener('click', fillExample);
    resetBtn.addEventListener('click', ()=>{ form.reset(); resultBox.classList.add('hidden'); alertBox.classList.add('hidden'); });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      alertBox.classList.add('hidden');
      resultBox.classList.add('hidden');

      if(!form.checkValidity()){
        alertBox.textContent = 'Please fill out all required fields correctly.';
        alertBox.classList.remove('hidden'); return;
      }

      const payload = {
        MedInc: parseFloat(form.MedInc.value),
        HouseAge: parseFloat(form.HouseAge.value),
        AveRooms: parseFloat(form.AveRooms.value),
        AveBedrms: parseFloat(form.AveBedrms.value),
        Population: parseInt(form.Population.value),
        AveOccup: parseFloat(form.AveOccup.value),
        Latitude: parseFloat(form.Latitude.value),
        Longitude: parseFloat(form.Longitude.value),
      };

      try {
        setLoading(true);
        const res = await fetch('/api/predict', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(payload)
        });

        if(!res.ok){
          const err = await res.json().catch(()=>({detail:'Unknown error'}));
          throw new Error(err.detail || `HTTP ${res.status}`);
        }

        const data = await res.json();
        inputsBox.innerHTML = '';
        Object.entries(data.inputs).forEach(([k,v])=>{
          const key = document.createElement('div'); key.className='text-gray-600'; key.textContent=k;
          const val = document.createElement('div'); val.className='font-medium text-gray-900'; val.textContent=v;
          inputsBox.appendChild(key); inputsBox.appendChild(val);
        });

        predBox.textContent = money(data.prediction_usd);
        resultBox.classList.remove('hidden');
      } catch(err){
        alertBox.textContent = err.message || 'Something went wrong.';
        alertBox.classList.remove('hidden');
      } finally {
        setLoading(false);
      }
    });
  </script>
</body>
</html>
